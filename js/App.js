import{TodoListDom}from"./ToDoList/TodoListDom.js";import{Timer}from"./Timer/Timer.js";import{Statistics}from"./Statistics/Statistics.js";import{Distraction}from"./Distraction/Distraction.js";import{longBreakColors,shortBreakColors,workModeColors}from"./Misc/ChangeColors.js";import{breakModeSound,workModeSound}from"./Misc/Sounds.js";import{classNames}from"./ToDoList/TaskVariables.js";import{DistractedByDevice}from"./Distraction/DistractedByDevice.js";function after3amToday(){return(new Date).getHours()>=3}const navBar=document.querySelector("nav"),timeDisplay=document.getElementById("timeDisplay"),modeDisplay=document.getElementById("modeDisplay"),todoTable=document.getElementById("todo"),addTodoForm=document.getElementById("add-todo"),addTodoButton=document.getElementById("add-button"),startTimerButton=document.getElementById("startTimer"),statsButton=document.getElementById("statsButton"),distractButton=document.getElementById("distractionButton"),distractPopUp=document.getElementById("distract-popup"),cancelButton=document.getElementById("cancel-button"),distractForm=document.getElementById("distract-form"),description=document.getElementById("description"),statsPopUp=document.getElementById("stats-section"),parentDiv=document.getElementById("parentDiv"),closeStatsButton=document.getElementById("close-stats-button"),deleteAllButton=document.getElementById("delete-all-button"),overlay=document.getElementById("overlay"),statsTabBtn=document.getElementById("data"),currentTaskDiv=document.getElementById("currentTask"),tourButton=document.getElementById("onboardingButton"),finishTaskBtn=document.getElementById("finishTask"),StatsPage=new Statistics,TDLDom=new TodoListDom(todoTable,addTodoForm,addTodoButton,deleteAllButton,finishTaskBtn,currentTaskDiv),TimerObj=new Timer(startTimerButton,timeDisplay,modeDisplay),DistractionPage=new Distraction(distractButton,distractPopUp,cancelButton,distractForm,description,overlay),noDeviceSwitch=document.getElementById("noDeviceSwitch"),distractedByDevice=new DistractedByDevice(noDeviceSwitch,modeDisplay),navButtons=[document.getElementById("faqButton"),document.getElementById("statsButton"),document.getElementById("settingsButton"),document.getElementById("onboardingButton")];function updateSessionIndicators(t){const e=document.querySelectorAll(".indicator");if(7===t)for(let t=0;t<e.length;t+=1)e[t].textContent="trip_origin";else e[6-t].textContent="circle"}function enterFocusMode(){todoTable.parentElement.style.opacity="0",todoTable.parentElement.style.visibility="hidden",todoTable.parentElement.style.transition="visibility 0s 0.25s, opacity 0.25s linear",timeDisplay.parentElement.parentElement.classList.add("focus"),currentTaskDiv.classList.add("focus"),navBar.style.transitionDuration="0.2s",navBar.classList.add("focus"),document.getElementById("sessionIndicator").style.opacity=0,document.getElementById("sessionIndicator").classList.add("focus")}function exitFocusMode(){todoTable.parentElement.style.opacity="1",todoTable.parentElement.style.visibility="visible",todoTable.parentElement.style.transition="opacity 1s linear",todoTable.parentElement.style.transitionDelay="1s",timeDisplay.parentElement.parentElement.classList.remove("focus"),currentTaskDiv.classList.remove("focus"),navBar.style.transitionDuration="0.2s",navBar.classList.remove("focus"),document.getElementById("sessionIndicator").style.opacity=1,document.getElementById("sessionIndicator").classList.remove("focus")}function distractionCreated(t){t.detail.pomoSessionId=TimerObj.sessionId,TimerObj.resetSession(),StatsPage.addDistraction(t.detail)}null===localStorage.getItem("onboarding")&&(introJs().start(),localStorage.setItem("onboarding","true")),tourButton.addEventListener("click",(()=>{introJs().start()})),TimerObj.addEventListener("timer-complete",(t=>{t.detail.sessionIsWork?(distractedByDevice.endPomoTime(),TDLDom.onSessionComplete(),StatsPage.addWorkTime(t.detail.duration),StatsPage.incrementActualPomoSessions(),"Short Break"===t.detail.nextSessionName?shortBreakColors():longBreakColors(),breakModeSound()):(StatsPage.addTimeSpent(t.detail.duration),workModeColors(),workModeSound()),updateSessionIndicators(t.detail.longBreakLocation)})),startTimerButton.addEventListener("click",(()=>{if(StatsPage.dataToCompressExists()&&StatsPage.clearData(),"Start"===startTimerButton.childNodes[0].nodeValue){StatsPage.compressStats();const t=new Date(2e3,0,1);localStorage.setItem("startDateTime",t),StatsPage.sessionStartDateTime=t}})),TimerObj.addEventListener("timer-start",(t=>{t.detail.sessionIsWork?(distractButton.disabled=!1,navButtons.forEach((t=>{t.style.opacity="0",t.style.pointerEvents="none"})),distractedByDevice.startPomoTime(),enterFocusMode()):(distractButton.disabled=!0,DistractionPage.resetPopUp(),navButtons.forEach((t=>{t.style.opacity="1",t.style.pointerEvents="auto"})),exitFocusMode())})),TimerObj.addEventListener("timer-end",(()=>{distractButton.disabled=!0,distractedByDevice.endPomoTime(),DistractionPage.resetPopUp(),navButtons.forEach((t=>{t.style.opacity="1",t.style.pointerEvents="auto"})),exitFocusMode()})),document.body.addEventListener("task-up",(t=>{TDLDom.moveTaskUp(t.detail.taskID),TDLDom.updateCurrentTask()})),document.body.addEventListener("task-down",(t=>{TDLDom.moveTaskDown(t.detail.taskID),TDLDom.updateCurrentTask()})),document.body.addEventListener("focus-task",(t=>{TDLDom.onFocusTask(t.detail.taskID),TDLDom.updateCurrentTask()})),document.body.addEventListener("task-deleted",(t=>{TDLDom.todoList.removeTask(t.detail.taskID),TDLDom.updateCurrentTask()})),document.body.addEventListener("checkbox-updated",(t=>{!0===t.detail.checkBoxState?TDLDom.onCompletedTask():TDLDom.onUncheckedTask(t.detail.taskID),TDLDom.updateCurrentTask()})),window.addEventListener("click",(t=>{const e=document.getElementsByClassName(classNames.lastCol);let o=!1;for(let s=0;s<e.length&&!o;s+=1)e[s].contains(t.target)&&(o=!0);if(!o){const t=document.getElementsByClassName(classNames.doubleButtons),e=document.getElementsByClassName(classNames.threeDotsWrapper);for(let o=0;o<t.length;o+=1)t[o].style.display="none",e[o].style.display="flex"}})),TDLDom.todoList.addEventListener("task-added",(t=>{StatsPage.addExpectedPomoSessions(t.detail.duration)})),TDLDom.todoList.addEventListener("task-checked-off",(()=>{StatsPage.incrementTasksCompleted()})),TDLDom.todoList.addEventListener("task-unchecked",(()=>{StatsPage.decrementTasksCompleted()})),TDLDom.todoList.addEventListener("task-deleted",(t=>{StatsPage.deleteExpectedPomoSessions(t.detail.pomoSessions)})),DistractionPage.addEventListener("distraction-created",distractionCreated),distractedByDevice.addEventListener("distraction-created",distractionCreated),StatsPage.addEventListener("reset-timer",(()=>{TimerObj.resetPomoSessionId()})),statsButton.addEventListener("click",(()=>{StatsPage.updateDom(),statsPopUp.style.display="block",parentDiv.style.display="block",statsPopUp.style.animation="fadeEffect-popup 1s",overlay.style.animation="fadeEffect-overlay 1s",parentDiv.setAttribute("class","slide-in"),document.getElementById("overlay").style.display="block"})),closeStatsButton.addEventListener("click",(()=>{parentDiv.setAttribute("class","slide-out"),statsPopUp.style.display="none",document.getElementById("overlay").style.display="none"})),after3amToday()&&StatsPage.dataToCompressExists()&&(StatsPage.compressStats(),StatsPage.clearData()),statsTabBtn.click(),navBar.addEventListener("transitionend",(()=>{navBar.style.transitionDuration="0.2s"}));
